[
  {
    "tool_name": "unknown",
    "tool_input": {},
    "session_id": "d83a02ef-54bc-4d79-87eb-d4442f328bd5",
    "correlation_id": "e7eb16fe-0a51-4313-906e-a62af54c5612",
    "cwd": "/home/bryan/speak-app",
    "payload": {
      "session_id": "d83a02ef-54bc-4d79-87eb-d4442f328bd5",
      "transcript_path": "/home/bryan/.claude/projects/-home-bryan-speak-app/d83a02ef-54bc-4d79-87eb-d4442f328bd5.jsonl",
      "cwd": "/home/bryan/speak-app",
      "permission_mode": "plan",
      "hook_event_name": "PreToolUse",
      "tool_name": "Grep",
      "tool_input": {
        "pattern": "import elevenlabs_tts|import openai_tts|import pyttsx3_tts|import tts_provider",
        "path": ".claude/hooks",
        "output_mode": "files_with_matches"
      }
    }
  },
  {
    "tool_name": "unknown",
    "tool_input": {},
    "session_id": "d83a02ef-54bc-4d79-87eb-d4442f328bd5",
    "correlation_id": "b7b1d527-5fc8-48d1-a3ca-6a3198a6bc17",
    "cwd": "/home/bryan/speak-app",
    "payload": {
      "session_id": "d83a02ef-54bc-4d79-87eb-d4442f328bd5",
      "transcript_path": "/home/bryan/.claude/projects/-home-bryan-speak-app/d83a02ef-54bc-4d79-87eb-d4442f328bd5.jsonl",
      "cwd": "/home/bryan/speak-app",
      "permission_mode": "plan",
      "hook_event_name": "PreToolUse",
      "tool_name": "Read",
      "tool_input": {
        "file_path": "/home/bryan/speak-app/.claude/hooks/utils/tts/coordinated_speak.py",
        "limit": 176
      }
    }
  },
  {
    "tool_name": "unknown",
    "tool_input": {},
    "tool_output": "",
    "success": true,
    "session_id": "d83a02ef-54bc-4d79-87eb-d4442f328bd5",
    "cwd": "/home/bryan/speak-app",
    "payload": {
      "session_id": "d83a02ef-54bc-4d79-87eb-d4442f328bd5",
      "transcript_path": "/home/bryan/.claude/projects/-home-bryan-speak-app/d83a02ef-54bc-4d79-87eb-d4442f328bd5.jsonl",
      "cwd": "/home/bryan/speak-app",
      "permission_mode": "plan",
      "hook_event_name": "PostToolUse",
      "tool_name": "Read",
      "tool_input": {
        "file_path": "/home/bryan/speak-app/.claude/hooks/utils/tts/coordinated_speak.py",
        "limit": 176
      },
      "tool_response": {
        "type": "text",
        "file": {
          "filePath": "/home/bryan/speak-app/.claude/hooks/utils/tts/coordinated_speak.py",
          "content": "#!/usr/bin/env python3\n\"\"\"\nCoordinated TTS module for hooks.\nProvides queue-based TTS notifications to prevent audio overlap.\nFalls back to direct speak command if queue coordinator is unavailable.\n\"\"\"\n\nimport json\nimport os\nimport socket\nimport subprocess\nimport sys\nfrom pathlib import Path\nfrom typing import Dict, Optional, Any\n\n\ndef send_queued_speak(content: str, priority: str = \"medium\", \n                     message_type: str = \"info\", hook_type: str = \"\",\n                     tool_name: str = \"\", metadata: Optional[Dict] = None) -> bool:\n    \"\"\"\n    Send a speak request to the queue coordinator.\n    \n    Args:\n        content: Message content to speak\n        priority: Priority level (low, medium, high, critical, interrupt)\n        message_type: Type of message (info, warning, error, success, interrupt)\n        hook_type: Hook that triggered this (pre_tool_use, post_tool_use, stop, etc.)\n        tool_name: Tool name if applicable\n        metadata: Additional metadata\n        \n    Returns:\n        True if successfully queued, False otherwise\n    \"\"\"\n    socket_path = Path(\"/tmp/tts_queue_coordinator.sock\")\n    \n    # Check if coordinator is running\n    if not socket_path.exists():\n        return False\n        \n    try:\n        # Connect to coordinator\n        client_socket = socket.socket(socket.AF_UNIX, socket.SOCK_STREAM)\n        client_socket.settimeout(1.0)  # 1 second timeout\n        client_socket.connect(str(socket_path))\n        \n        # Prepare request\n        request = {\n            \"action\": \"speak\",\n            \"content\": content,\n            \"priority\": priority,\n            \"message_type\": message_type,\n            \"hook_type\": hook_type,\n            \"tool_name\": tool_name,\n            \"metadata\": metadata or {}\n        }\n        \n        # Send request\n        client_socket.send(json.dumps(request).encode() + b'\\n')\n        \n        # Receive response\n        response_data = b\"\"\n        while True:\n            chunk = client_socket.recv(4096)\n            if not chunk:\n                break\n            response_data += chunk\n            if b'\\n' in response_data:\n                break\n                \n        response = json.loads(response_data.decode())\n        \n        return response.get(\"status\") == \"success\"\n        \n    except (socket.timeout, ConnectionRefusedError, OSError):\n        # Coordinator not available or not responding\n        return False\n    except Exception:\n        # Any other error\n        return False\n    finally:\n        try:\n            client_socket.close()\n        except:\n            pass\n\n\ndef notify_tts_coordinated(message: str, priority: str = \"normal\",\n                          hook_type: str = \"\", tool_name: str = \"\",\n                          metadata: Optional[Dict] = None) -> bool:\n    \"\"\"\n    Send a coordinated TTS notification using the queue system.\n    Falls back to direct speak command if coordinator is unavailable.\n    \n    Args:\n        message: The message to speak\n        priority: Priority level (normal, important, error)\n        hook_type: Hook that triggered this notification\n        tool_name: Tool name if applicable\n        metadata: Additional metadata\n        \n    Returns:\n        True if successful, False otherwise\n    \"\"\"\n    try:\n        # Skip TTS if disabled\n        if os.getenv('TTS_ENABLED', 'true').lower() != 'true':\n            return False\n        \n        # Get engineer name for personalization\n        engineer_name = os.getenv('ENGINEER_NAME', 'Developer')\n        \n        # Format message based on priority (following speak command patterns)\n        if priority == \"error\":\n            personalized_message = f\"{engineer_name}, Error: {message}\"\n            queue_priority = \"critical\"\n            message_type = \"error\"\n        elif priority == \"important\":\n            personalized_message = f\"{engineer_name}, Important: {message}\"\n            queue_priority = \"high\"\n            message_type = \"warning\"\n        else:\n            personalized_message = f\"{engineer_name}, {message}\"\n            queue_priority = \"medium\"\n            message_type = \"info\"\n        \n        # Try to use queue coordinator first\n        if send_queued_speak(\n            content=personalized_message,\n            priority=queue_priority,\n            message_type=message_type,\n            hook_type=hook_type,\n            tool_name=tool_name,\n            metadata=metadata\n        ):\n            return True\n        \n        # Fallback to simple lock mechanism if coordinator unavailable\n        try:\n            from .simple_lock_coordinator import speak_with_simple_lock\n            \n            # Use simple lock to prevent overlap\n            timeout_map = {\n                \"error\": 45.0,\n                \"important\": 30.0,\n                \"normal\": 20.0\n            }\n            timeout = timeout_map.get(priority, 20.0)\n            \n            return speak_with_simple_lock(personalized_message, timeout=timeout)\n            \n        except ImportError:\n            # Final fallback to direct speak command\n            subprocess.Popen(\n                ['speak', personalized_message],\n                stdout=subprocess.DEVNULL,\n                stderr=subprocess.DEVNULL\n            )\n            return True\n        \n    except Exception:\n        # Silently fail - don't disrupt the hook\n        return False\n\n\ndef is_coordinator_available() -> bool:\n    \"\"\"\n    Check if the TTS queue coordinator is available.\n    \n    Returns:\n        True if coordinator is running and responsive, False otherwise\n    \"\"\"\n    socket_path = Path(\"/tmp/tts_queue_coordinator.sock\")\n    return socket_path.exists()\n\n\n# For backward compatibility",
          "numLines": 176,
          "startLine": 1,
          "totalLines": 177
        }
      }
    }
  },
  {
    "tool_name": "unknown",
    "tool_input": {},
    "session_id": "d83a02ef-54bc-4d79-87eb-d4442f328bd5",
    "correlation_id": "a3593595-162f-4160-ac08-2205945d60a9",
    "cwd": "/home/bryan/speak-app",
    "payload": {
      "session_id": "d83a02ef-54bc-4d79-87eb-d4442f328bd5",
      "transcript_path": "/home/bryan/.claude/projects/-home-bryan-speak-app/d83a02ef-54bc-4d79-87eb-d4442f328bd5.jsonl",
      "cwd": "/home/bryan/speak-app",
      "permission_mode": "plan",
      "hook_event_name": "PreToolUse",
      "tool_name": "Bash",
      "tool_input": {
        "command": "diff .claude/hooks/utils/tts/openai_tts.py tts/openai_tts.py | head -20",
        "description": "Compare hook vs main TTS files"
      }
    }
  },
  {
    "tool_name": "unknown",
    "tool_input": {},
    "session_id": "d83a02ef-54bc-4d79-87eb-d4442f328bd5",
    "correlation_id": "d74af232-b6f4-4f22-8713-4eaed7228192",
    "cwd": "/home/bryan/speak-app",
    "payload": {
      "session_id": "d83a02ef-54bc-4d79-87eb-d4442f328bd5",
      "transcript_path": "/home/bryan/.claude/projects/-home-bryan-speak-app/d83a02ef-54bc-4d79-87eb-d4442f328bd5.jsonl",
      "cwd": "/home/bryan/speak-app",
      "permission_mode": "plan",
      "hook_event_name": "PreToolUse",
      "tool_name": "Bash",
      "tool_input": {
        "command": "wc -l .claude/hooks/utils/tts/openai_tts.py tts/openai_tts.py",
        "description": "Compare file sizes"
      }
    }
  },
  {
    "tool_name": "unknown",
    "tool_input": {},
    "tool_output": "",
    "success": true,
    "session_id": "d83a02ef-54bc-4d79-87eb-d4442f328bd5",
    "cwd": "/home/bryan/speak-app",
    "payload": {
      "session_id": "d83a02ef-54bc-4d79-87eb-d4442f328bd5",
      "transcript_path": "/home/bryan/.claude/projects/-home-bryan-speak-app/d83a02ef-54bc-4d79-87eb-d4442f328bd5.jsonl",
      "cwd": "/home/bryan/speak-app",
      "permission_mode": "plan",
      "hook_event_name": "PostToolUse",
      "tool_name": "Bash",
      "tool_input": {
        "command": "diff .claude/hooks/utils/tts/openai_tts.py tts/openai_tts.py | head -20",
        "description": "Compare hook vs main TTS files"
      },
      "tool_response": {
        "stdout": "74,87c74,145\n<             response.stream_to_file(tmp_path)\n<         \n<         # Play the audio using pygame\n<         pygame.mixer.init()\n<         pygame.mixer.music.load(tmp_path)\n<         pygame.mixer.music.play()\n<         \n<         # Wait for playback to complete\n<         while pygame.mixer.music.get_busy():\n<             pygame.time.Clock().tick(10)\n<         \n<         # Cleanup\n<         pygame.mixer.quit()\n<         os.unlink(tmp_path)\n---\n>             # Write response content to file (avoiding deprecated stream_to_file)\n>             for chunk in response.iter_bytes():\n>                 tmp_file.write(chunk)\n>",
        "stderr": "",
        "interrupted": false,
        "isImage": false
      }
    },
    "correlation_id": "d74af232-b6f4-4f22-8713-4eaed7228192"
  },
  {
    "tool_name": "unknown",
    "tool_input": {},
    "tool_output": "",
    "success": true,
    "session_id": "d83a02ef-54bc-4d79-87eb-d4442f328bd5",
    "cwd": "/home/bryan/speak-app",
    "payload": {
      "session_id": "d83a02ef-54bc-4d79-87eb-d4442f328bd5",
      "transcript_path": "/home/bryan/.claude/projects/-home-bryan-speak-app/d83a02ef-54bc-4d79-87eb-d4442f328bd5.jsonl",
      "cwd": "/home/bryan/speak-app",
      "permission_mode": "plan",
      "hook_event_name": "PostToolUse",
      "tool_name": "Bash",
      "tool_input": {
        "command": "wc -l .claude/hooks/utils/tts/openai_tts.py tts/openai_tts.py",
        "description": "Compare file sizes"
      },
      "tool_response": {
        "stdout": "  121 .claude/hooks/utils/tts/openai_tts.py\n  234 tts/openai_tts.py\n  355 total",
        "stderr": "",
        "interrupted": false,
        "isImage": false
      }
    }
  },
  {
    "session_id": "d83a02ef-54bc-4d79-87eb-d4442f328bd5",
    "transcript_path": "/home/bryan/.claude/projects/-home-bryan-speak-app/d83a02ef-54bc-4d79-87eb-d4442f328bd5.jsonl",
    "cwd": "/home/bryan/speak-app",
    "permission_mode": "plan",
    "hook_event_name": "Stop",
    "stop_hook_active": false
  },
  {
    "session_id": "d83a02ef-54bc-4d79-87eb-d4442f328bd5",
    "transcript_path": "/home/bryan/.claude/projects/-home-bryan-speak-app/d83a02ef-54bc-4d79-87eb-d4442f328bd5.jsonl",
    "cwd": "/home/bryan/speak-app",
    "permission_mode": "plan",
    "hook_event_name": "UserPromptSubmit",
    "prompt": "proceed... we have them in the git repo do we not? so we could still get to them in a past commit"
  },
  {
    "tool_name": "unknown",
    "tool_input": {},
    "session_id": "d83a02ef-54bc-4d79-87eb-d4442f328bd5",
    "correlation_id": "3234b207-1065-4c59-ac85-a59070089283",
    "cwd": "/home/bryan/speak-app",
    "payload": {
      "session_id": "d83a02ef-54bc-4d79-87eb-d4442f328bd5",
      "transcript_path": "/home/bryan/.claude/projects/-home-bryan-speak-app/d83a02ef-54bc-4d79-87eb-d4442f328bd5.jsonl",
      "cwd": "/home/bryan/speak-app",
      "permission_mode": "plan",
      "hook_event_name": "PreToolUse",
      "tool_name": "Bash",
      "tool_input": {
        "command": "rm -v .claude/hooks/utils/tts/adaptive_cleanup.py \\\n  .claude/hooks/utils/tts/config_manager.py \\\n  .claude/hooks/utils/tts/elevenlabs_tts.py \\\n  .claude/hooks/utils/tts/openai_tts.py \\\n  .claude/hooks/utils/tts/pyttsx3_tts.py \\\n  .claude/hooks/utils/tts/tts_provider.py",
        "description": "Remove unused provider duplicates"
      }
    }
  },
  {
    "session_id": "d83a02ef-54bc-4d79-87eb-d4442f328bd5",
    "transcript_path": "/home/bryan/.claude/projects/-home-bryan-speak-app/d83a02ef-54bc-4d79-87eb-d4442f328bd5.jsonl",
    "cwd": "/home/bryan/speak-app",
    "hook_event_name": "Notification",
    "message": "Claude needs your permission to use Bash"
  },
  {
    "tool_name": "unknown",
    "tool_input": {},
    "tool_output": "",
    "success": true,
    "session_id": "d83a02ef-54bc-4d79-87eb-d4442f328bd5",
    "cwd": "/home/bryan/speak-app",
    "payload": {
      "session_id": "d83a02ef-54bc-4d79-87eb-d4442f328bd5",
      "transcript_path": "/home/bryan/.claude/projects/-home-bryan-speak-app/d83a02ef-54bc-4d79-87eb-d4442f328bd5.jsonl",
      "cwd": "/home/bryan/speak-app",
      "permission_mode": "plan",
      "hook_event_name": "PostToolUse",
      "tool_name": "Bash",
      "tool_input": {
        "command": "rm -v .claude/hooks/utils/tts/adaptive_cleanup.py \\\n  .claude/hooks/utils/tts/config_manager.py \\\n  .claude/hooks/utils/tts/elevenlabs_tts.py \\\n  .claude/hooks/utils/tts/openai_tts.py \\\n  .claude/hooks/utils/tts/pyttsx3_tts.py \\\n  .claude/hooks/utils/tts/tts_provider.py",
        "description": "Remove unused provider duplicates"
      },
      "tool_response": {
        "stdout": "removed '.claude/hooks/utils/tts/adaptive_cleanup.py'\nremoved '.claude/hooks/utils/tts/config_manager.py'\nremoved '.claude/hooks/utils/tts/elevenlabs_tts.py'\nremoved '.claude/hooks/utils/tts/openai_tts.py'\nremoved '.claude/hooks/utils/tts/pyttsx3_tts.py'\nremoved '.claude/hooks/utils/tts/tts_provider.py'",
        "stderr": "",
        "interrupted": false,
        "isImage": false
      }
    },
    "correlation_id": "3234b207-1065-4c59-ac85-a59070089283"
  },
  {
    "tool_name": "unknown",
    "tool_input": {},
    "session_id": "d83a02ef-54bc-4d79-87eb-d4442f328bd5",
    "correlation_id": "fd374625-2fc4-4ccb-9219-5cce5dff7899",
    "cwd": "/home/bryan/speak-app",
    "payload": {
      "session_id": "d83a02ef-54bc-4d79-87eb-d4442f328bd5",
      "transcript_path": "/home/bryan/.claude/projects/-home-bryan-speak-app/d83a02ef-54bc-4d79-87eb-d4442f328bd5.jsonl",
      "cwd": "/home/bryan/speak-app",
      "permission_mode": "plan",
      "hook_event_name": "PreToolUse",
      "tool_name": "Bash",
      "tool_input": {
        "command": "wc -l .claude/hooks/utils/tts/*.py",
        "description": "Count final line count"
      }
    }
  },
  {
    "tool_name": "unknown",
    "tool_input": {},
    "tool_output": "",
    "success": true,
    "session_id": "d83a02ef-54bc-4d79-87eb-d4442f328bd5",
    "cwd": "/home/bryan/speak-app",
    "payload": {
      "session_id": "d83a02ef-54bc-4d79-87eb-d4442f328bd5",
      "transcript_path": "/home/bryan/.claude/projects/-home-bryan-speak-app/d83a02ef-54bc-4d79-87eb-d4442f328bd5.jsonl",
      "cwd": "/home/bryan/speak-app",
      "permission_mode": "plan",
      "hook_event_name": "PostToolUse",
      "tool_name": "Bash",
      "tool_input": {
        "command": "ls -lh .claude/hooks/utils/tts/*.py",
        "description": "Check final remaining files"
      },
      "tool_response": {
        "stdout": "-rw-r--r-- 1 bryan bryan 5.6K Oct  9 09:38 .claude/hooks/utils/tts/coordinated_speak.py\n-rw-r--r-- 1 bryan bryan   37 Oct  9 09:38 .claude/hooks/utils/tts/__init__.py\n-rw-r--r-- 1 bryan bryan 7.5K Oct  9 09:38 .claude/hooks/utils/tts/observability.py\n-rw-r--r-- 1 bryan bryan 5.3K Oct  9 09:38 .claude/hooks/utils/tts/simple_lock_coordinator.py",
        "stderr": "",
        "interrupted": false,
        "isImage": false
      }
    },
    "correlation_id": "312a130e-0dfe-4d94-b6f2-1f7cdf9ec164"
  },
  {
    "tool_name": "unknown",
    "tool_input": {},
    "tool_output": "",
    "success": true,
    "session_id": "d83a02ef-54bc-4d79-87eb-d4442f328bd5",
    "cwd": "/home/bryan/speak-app",
    "payload": {
      "session_id": "d83a02ef-54bc-4d79-87eb-d4442f328bd5",
      "transcript_path": "/home/bryan/.claude/projects/-home-bryan-speak-app/d83a02ef-54bc-4d79-87eb-d4442f328bd5.jsonl",
      "cwd": "/home/bryan/speak-app",
      "permission_mode": "plan",
      "hook_event_name": "PostToolUse",
      "tool_name": "Bash",
      "tool_input": {
        "command": "wc -l .claude/hooks/utils/tts/*.py",
        "description": "Count final line count"
      },
      "tool_response": {
        "stdout": "  176 .claude/hooks/utils/tts/coordinated_speak.py\n    0 .claude/hooks/utils/tts/__init__.py\n  235 .claude/hooks/utils/tts/observability.py\n  181 .claude/hooks/utils/tts/simple_lock_coordinator.py\n  592 total",
        "stderr": "",
        "interrupted": false,
        "isImage": false
      }
    }
  },
  {
    "tool_name": "unknown",
    "tool_input": {},
    "session_id": "d83a02ef-54bc-4d79-87eb-d4442f328bd5",
    "correlation_id": "ac38f48b-2820-42c3-a743-2686dd5d03ef",
    "cwd": "/home/bryan/speak-app",
    "payload": {
      "session_id": "d83a02ef-54bc-4d79-87eb-d4442f328bd5",
      "transcript_path": "/home/bryan/.claude/projects/-home-bryan-speak-app/d83a02ef-54bc-4d79-87eb-d4442f328bd5.jsonl",
      "cwd": "/home/bryan/speak-app",
      "permission_mode": "plan",
      "hook_event_name": "PreToolUse",
      "tool_name": "Bash",
      "tool_input": {
        "command": "git add -A && git status --short",
        "description": "Stage TTS utility deletions"
      }
    }
  }
]